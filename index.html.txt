<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Salma's Supreme Realm ğŸ‘‘</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&family=Cairo:wght@400;700;900&family=Orbitron:wght@800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --main: #ff007f; 
            --bg: #0f0c29; 
            --bg-gradient: linear-gradient(to bottom, #0f0c29, #302b63, #24243e);
            --card: rgba(255, 255, 255, 0.05); 
            --border: rgba(255, 255, 255, 0.1);
            --text: #fff; 
            --gold: #ffd700;
            --success: #00e676;
            --danger: #ff1744;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: var(--bg-gradient); color: var(--text); font-family: 'Cairo', sans-serif; overflow: hidden; height: 100vh; transition: 0.5s; }

        /* Ø®Ù„ÙÙŠØ© Ø§Ù„Ù†Ø¬ÙˆÙ… */
        .stars-container { position: fixed; top: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        .star { position: absolute; background: white; border-radius: 50%; animation: twinkle var(--d) infinite; opacity: 0; }
        @keyframes twinkle { 0% { opacity: 0; transform: scale(0.5); } 50% { opacity: 0.8; transform: scale(1.2); } 100% { opacity: 0; transform: scale(0.5); } }

        /* Ø§Ù„Ø­Ø§ÙˆÙŠØ© */
        .container { height: 100vh; display: flex; flex-direction: column; padding: 20px; overflow-y: auto; padding-bottom: 110px; scrollbar-width: none; }
        .container::-webkit-scrollbar { display: none; }
        
        section { display: none; animation: slideUp 0.5s cubic-bezier(0.18, 0.89, 0.32, 1.28); }
        section.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(40px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }

        /* Ø§Ù„ÙƒØ±ÙˆØª Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠØ© */
        .card { 
            background: var(--card); 
            border: 1px solid var(--border); 
            backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
            border-radius: 24px; padding: 20px; margin-bottom: 20px; 
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            position: relative; overflow: hidden;
        }

        h1 { text-align: center; margin-bottom: 20px; font-weight: 900; letter-spacing: -0.5px; text-shadow: 0 5px 15px rgba(0,0,0,0.3); }

        /* Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… */
        .item-row { 
            background: rgba(255,255,255,0.03); padding: 18px; border-radius: 18px; margin-bottom: 12px; 
            display: flex; justify-content: space-between; align-items: center; 
            border: 1px solid transparent; cursor: pointer; transition: 0.3s; 
            position: relative;
        }
        .item-row:active { transform: scale(0.97); }
        .item-row.done { background: linear-gradient(90deg, rgba(255,255,255,0.1), transparent); border-right: 4px solid var(--main); }
        
        /* Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ£Ø®ÙŠØ± */
        .late-badge { 
            background: var(--danger); color: white; font-size: 0.7rem; padding: 2px 8px; border-radius: 10px; 
            margin-left: 10px; animation: pulse 1s infinite; display: none;
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ */
        .navbar { 
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); 
            width: 95%; height: 75px; background: rgba(20, 20, 20, 0.85); backdrop-filter: blur(20px); 
            border-radius: 40px; display: flex; justify-content: space-evenly; align-items: center; 
            border: 1px solid rgba(255,255,255,0.15); box-shadow: 0 10px 40px rgba(0,0,0,0.5); z-index: 1000; 
        }
        .nav-btn { font-size: 1.6rem; opacity: 0.5; transition: 0.4s; color: white; display: flex; align-items: center; justify-content: center; width: 50px; height: 50px; border-radius: 50%; position: relative; }
        .nav-btn.active { opacity: 1; background: var(--main); color: white; transform: translateY(-20px) scale(1.1); box-shadow: 0 10px 25px var(--main); border: 2px solid #fff; }
        .nav-dot { position: absolute; top: 10px; right: 10px; width: 10px; height: 10px; background: #ff0000; border-radius: 50%; border: 1px solid #fff; display: none; animation: pulse 1s infinite; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn-action { 
            background: var(--main); color: white; border: none; padding: 18px; 
            border-radius: 20px; width: 100%; font-weight: 900; cursor: pointer; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); font-family: 'Cairo'; margin-top: 10px;
            font-size: 1.1rem; transition: 0.2s;
        }
        .btn-action:active { transform: scale(0.95); }
        input[type="text"] { width: 100%; padding: 18px; border-radius: 18px; border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.3); color: inherit; margin-bottom: 15px; font-family: inherit; font-size: 1rem; }

        /* Hero Spinner */
        .hero-power-container { position: relative; width: 220px; height: 220px; margin: 20px auto; display: flex; align-items: center; justify-content: center; }
        .hero-ring { position: absolute; inset: 0; border-radius: 50%; border: 10px solid transparent; border-top-color: var(--main); border-left-color: var(--main); animation: spin 3s linear infinite; filter: drop-shadow(0 0 10px var(--main)); }
        .hero-ring::before { content: ''; position: absolute; inset: 15px; border-radius: 50%; border: 5px solid transparent; border-bottom-color: #fff; border-right-color: #fff; animation: spinReverse 5s linear infinite; opacity: 0.5; }
        .hero-number { font-size: 5rem; font-weight: 900; color: #fff; z-index: 2; text-shadow: 0 0 30px var(--main); font-family: 'Orbitron', sans-serif; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes spinReverse { to { transform: rotate(-360deg); } }

        /* Stats & Chart */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-box { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .stat-val { font-size: 1.8rem; font-weight: 900; color: var(--main); margin: 5px 0; }
        .chart-wrapper { display: flex; align-items: flex-end; justify-content: space-between; height: 150px; padding-top: 20px; gap: 5px; }
        .bar-col { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end; height: 100%; }
        .bar { width: 80%; background: rgba(255,255,255,0.1); border-radius: 50px; transition: height 1s; min-height: 5px; }
        .bar.high { background: var(--main); box-shadow: 0 0 15px var(--main); }

        /* --- ØªØµÙ…ÙŠÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø§Ø­ØªØ±Ø§ÙÙŠ) --- */
        .badge-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.05) 0%, rgba(0,0,0,0.2) 100%);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 24px; padding: 20px; margin-bottom: 20px;
            position: relative; overflow: hidden; transition: 0.3s;
        }
        .badge-card.locked { opacity: 0.7; filter: grayscale(0.8); pointer-events: none; }
        .badge-card.active-challenge { border: 2px solid var(--main); box-shadow: 0 0 20px rgba(255, 0, 127, 0.2); transform: scale(1.02); }
        .badge-card.completed { border: 1px solid var(--gold); background: linear-gradient(145deg, rgba(255, 215, 0, 0.1), rgba(0,0,0,0.3)); }
        
        .badge-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .badge-icon { font-size: 3rem; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 50%; width: 70px; height: 70px; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .badge-info h3 { margin: 0; font-size: 1.2rem; color: #fff; }
        .badge-info p { margin: 5px 0 0 0; font-size: 0.85rem; color: rgba(255,255,255,0.6); }

        .progress-area { margin-top: 15px; background: rgba(0,0,0,0.4); border-radius: 10px; padding: 10px; }
        .progress-label { display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 5px; color: #aaa; }
        .progress-bar { width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--main), #ff5e62); width: 0%; transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); border-radius: 10px; }
        
        .claim-btn {
            background: linear-gradient(45deg, var(--gold), #ff8c00);
            color: #000; font-weight: 900; border: none; width: 100%; padding: 15px;
            border-radius: 15px; margin-top: 15px; cursor: pointer;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
            animation: pulse-gold 1.5s infinite;
        }
        @keyframes pulse-gold { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }

        /* Lock Overlay */
        .lock-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; }
        .lock-icon { font-size: 2rem; margin-bottom: 10px; color: rgba(255,255,255,0.5); }

        /* Reward Modal Specifics */
        .reward-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 50000; display: none; align-items: center; justify-content: center; flex-direction: column; }
        .reward-content { text-align: center; animation: popUp 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .reward-icon { font-size: 6rem; filter: drop-shadow(0 0 50px var(--gold)); animation: float 3s ease-in-out infinite; }
        .reward-title { font-size: 2.5rem; color: var(--gold); margin: 20px 0; font-family: 'Orbitron'; text-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
        
        @keyframes popUp { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }

        /* Ø§Ù„Ù…ÙˆØ¯Ø§Øª */
        body.mode-holy { --main: #d4af37; --bg-gradient: linear-gradient(to bottom, #062c21, #0f4c3a); }
        body.mode-zen { --main: #ff85a2; --bg-gradient: linear-gradient(to top, #fff1eb 0%, #ace0f9 100%); --text: #4a4a4a; --card: rgba(255,255,255,0.65); }

        /* Default Modal */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); z-index: 20000; display: none; align-items: center; justify-content: center; padding: 25px; }
        .modal-box { background: #1a1a2e; border: 2px solid var(--main); border-radius: 30px; padding: 30px; width: 100%; text-align: center; color: white; box-shadow: 0 0 50px rgba(0,0,0,0.8); animation: zoomIn 0.3s; }
        @keyframes zoomIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* Splash */
        #splash { position: fixed; inset: 0; background: #000; display: flex; align-items: center; justify-content: center; z-index: 10000; transition: opacity 0.5s; }
        .splash-name { font-size: 5rem; font-family: 'Orbitron'; color: var(--main); text-shadow: 0 0 40px var(--main); animation: pulse 2s infinite; }
        
        /* --- New Features Styles --- */
        .profile-section { display: flex; align-items: center; justify-content: center; margin-bottom: 20px; flex-direction: column; }
        .profile-img-container { position: relative; width: 100px; height: 100px; }
        .profile-img { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid var(--main); box-shadow: 0 0 20px var(--main); cursor: pointer; background: #333; }
        .profile-badge { position: absolute; bottom: 0; right: 0; background: var(--gold); color: #000; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-size: 1rem; border: 2px solid #fff; }
        
        .timer-badge { background: rgba(0,0,0,0.3); padding: 5px 15px; border-radius: 20px; margin-bottom: 15px; font-family: 'Orbitron'; font-size: 0.9rem; border: 1px solid var(--border); display: inline-block;}
        
        .analytics-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.9rem; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 5px; }
        .analytics-row span:last-child { font-weight: bold; color: var(--main); }

        .history-list { max-height: 200px; overflow-y: auto; margin-top: 15px; }
        .history-item { display: flex; justify-content: space-between; padding: 10px; background: rgba(255,255,255,0.02); margin-bottom: 5px; border-radius: 10px; font-size: 0.9rem; }
    </style>
</head>
<body class="mode-comedy" id="main-body">

<div class="stars-container" id="stars"></div>

<div id="splash">
    <div class="splash-name">SALMA</div>
</div>

<div id="reward-modal" class="reward-modal" onclick="closeReward()">
    <div class="reward-content">
        <div class="reward-icon" id="r-icon">ğŸ‘‘</div>
        <div class="reward-title" id="r-title">Ù…Ù„ÙƒØ© Ù…ØªÙˆØ¬Ø©</div>
        <p style="color:white; font-size:1.2rem; max-width: 80%; margin: 0 auto;">Ù…Ø¨Ø±ÙˆÙƒ ÙŠØ§ Ø³Ù„Ù…Ù‰! Ø£Ø«Ø¨ØªØªÙ Ù„Ù†ÙØ³Ùƒ Ø£Ù†ÙƒÙ Ø§Ù„Ø£Ù‚ÙˆÙ‰.. Ù‡Ø°Ø§ Ø§Ù„ÙˆØ³Ø§Ù… ÙŠÙ„ÙŠÙ‚ Ø¨ÙƒÙ.</p>
        <button class="btn-action" style="background: white; color: black; width: 200px; margin-top: 30px;">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© âœ¨</button>
    </div>
</div>

<div id="modal" class="modal" onclick="this.style.display='none'">
    <div class="modal-box" onclick="event.stopPropagation()">
        <h2 id="m-title" style="color:var(--main); margin-top:0;"></h2>
        <p id="m-body" style="font-size: 1.3rem; font-weight: bold; margin: 20px 0;"></p>
        <div id="m-dua" style="font-style: italic; opacity: 0.8; margin-bottom: 25px; color: var(--main); font-size: 1rem;"></div>
        <button class="btn-action" onclick="document.getElementById('modal').style.display='none'">Ø§Ø³ØªÙ…Ø±Ø§Ø± âœ¨</button>
    </div>
</div>

<div class="container">
    <div class="profile-section">
        <div class="profile-img-container" onclick="document.getElementById('img-upload').click()">
            <img id="p-img" src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='70' x='15' font-size='60'>ğŸ‘‘</text></svg>" class="profile-img">
            <div class="profile-badge">âœ¨</div>
            <input type="file" id="img-upload" hidden accept="image/*" onchange="uploadImage(this)">
        </div>
        <div style="margin-top: 10px; font-weight: bold; font-size: 1.2rem;">Ø£Ù‡Ù„Ø§Ù‹ Ø³Ù„Ù…Ù‰ ğŸ‘‹</div>
    </div>

    <div style="display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 50px; width: fit-content; margin-left: auto; margin-right: auto;">
        <div onclick="applyMode('comedy')" style="width:35px; height:35px; background:#ff007f; border-radius:50%; cursor:pointer; box-shadow: 0 0 10px #ff007f;"></div>
        <div onclick="applyMode('holy')" style="width:35px; height:35px; background:#d4af37; border-radius:50%; cursor:pointer; box-shadow: 0 0 10px #d4af37;"></div>
        <div onclick="applyMode('zen')" style="width:35px; height:35px; background:#ff85a2; border-radius:50%; cursor:pointer; box-shadow: 0 0 10px #ff85a2;"></div>
    </div>

    <section id="prayers" class="active">
        <h1 id="h-prayers">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª</h1>
        <div style="text-align: center;">
            <div class="timer-badge" id="next-prayer-timer">Ø¬Ø§Ø±ÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª...</div>
        </div>
        
        <div class="card">
            <div class="item-row" id="fajr" onclick="markPrayer('fajr', 2, 4)">
                <span>ğŸŒ… ØµÙ„Ø§Ø© Ø§Ù„ÙØ¬Ø± <span class="late-badge" id="late-fajr">Ù…ØªØ£Ø®Ø±Ø©!</span></span> <b>Ø±ÙƒØ¹ØªØ§Ù†</b>
            </div>
            <div class="item-row" id="dhuhr" onclick="markPrayer('dhuhr', 4, 12)">
                <span>â˜€ï¸ ØµÙ„Ø§Ø© Ø§Ù„Ø¸Ù‡Ø± <span class="late-badge" id="late-dhuhr">Ù…ØªØ£Ø®Ø±Ø©!</span></span> <b>Ù¤ Ø±ÙƒØ¹Ø§Øª</b>
            </div>
            <div class="item-row" id="asr" onclick="markPrayer('asr', 4, 15)">
                <span>â›… ØµÙ„Ø§Ø© Ø§Ù„Ø¹ØµØ± <span class="late-badge" id="late-asr">Ù…ØªØ£Ø®Ø±Ø©!</span></span> <b>Ù¤ Ø±ÙƒØ¹Ø§Øª</b>
            </div>
            <div class="item-row" id="maghrib" onclick="markPrayer('maghrib', 3, 17)">
                <span>ğŸŒ† ØµÙ„Ø§Ø© Ø§Ù„Ù…ØºØ±Ø¨ <span class="late-badge" id="late-maghrib">Ù…ØªØ£Ø®Ø±Ø©!</span></span> <b>Ù£ Ø±ÙƒØ¹Ø§Øª</b>
            </div>
            <div class="item-row" id="isha" onclick="markPrayer('isha', 4, 19)">
                <span>ğŸŒ™ ØµÙ„Ø§Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡ <span class="late-badge" id="late-isha">Ù…ØªØ£Ø®Ø±Ø©!</span></span> <b>Ù¤ Ø±ÙƒØ¹Ø§Øª</b>
            </div>
        </div>
    </section>

    <section id="goals">
        <h1 id="h-goals">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù…ÙˆØ­Ø§Øª</h1>
        <div class="card">
            <input type="text" id="goal-in" placeholder="Ù…Ø§Ø°Ø§ Ø³Ù†Ù†Ø¬Ø² Ø§Ù„ÙŠÙˆÙ… ÙŠØ§ Ø³Ù„Ù…Ù‰ØŸ">
            <button class="btn-action" onclick="addGoal()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø© ğŸš€</button>
            <div id="goal-list" style="margin-top:20px;"></div>
        </div>
    </section>

    <section id="stats">
        <h1 id="h-stats">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡</h1>
        <div class="card">
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-lbl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±ÙƒØ¹Ø§Øª</div>
                    <div class="stat-val" id="st-total">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-lbl">Ø£ÙˆØ³Ù…Ø© Ø³Ù„Ù…Ù‰</div>
                    <div class="stat-val" id="st-badges">0</div>
                </div>
            </div>
            <div style="text-align: center; margin-top: 10px;">
                <small>Ù„Ù‚Ø¨ Ø³Ù„Ù…Ù‰ Ø§Ù„Ø­Ø§Ù„ÙŠ</small>
                <div id="st-rank" style="background: var(--main); color: #fff; padding: 8px 20px; border-radius: 20px; display: inline-block; margin-top: 5px; font-weight: bold; box-shadow: 0 5px 15px rgba(0,0,0,0.2);">Ù…Ø¨ØªØ¯Ø¦Ø©</div>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-top:0;">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø´Ø®ØµÙŠ</h3>
            <div class="analytics-row"><span>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ:</span> <span id="ana-avg">0%</span></div>
            <div class="analytics-row"><span>Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø£ÙƒØ«Ø± Ù†Ø´Ø§Ø·Ø§Ù‹:</span> <span id="ana-best">--</span></div>
            <div class="analytics-row"><span>Ù…Ø¬Ù…ÙˆØ¹ ØµÙ„ÙˆØ§Øª Ø§Ù„ÙŠÙˆÙ…:</span> <span id="ana-today">0</span></div>
            
            <div class="chart-wrapper" id="history-chart"></div>
            <div style="text-align: center; font-size: 0.7rem; opacity: 0.7; margin-top: 5px;">Ø£Ø¯Ø§Ø¡ Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù…</div>
        </div>

        <div class="card">
            <h3 style="margin-top:0; cursor: pointer;" onclick="document.getElementById('hist-list-wrap').style.display='block'">ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© (Ø§Ø¶ØºØ· Ù„Ù„Ø¹Ø±Ø¶)</h3>
            <div id="hist-list-wrap" style="display:none;">
                <div id="history-list" class="history-list"></div>
            </div>
        </div>
    </section>

    <section id="challenges">
        <h1 id="h-challenges">Ø±Ø­Ù„Ø© Ø§Ù„ØµØ¹ÙˆØ¯ ğŸ°</h1>
        <div style="text-align: center; margin-bottom: 25px; opacity: 0.8; font-size: 0.9rem;">Ø£Ø«Ø¨ØªÙŠ Ø¬Ø¯Ø§Ø±ØªÙƒ Ù„ÙØªØ­ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ù…ØºÙ„Ù‚Ø©</div>
        <div id="challenges-list"></div>
    </section>

    <section id="hero">
        <h1 id="h-hero">ØªØ­Ø¯ÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ©</h1>
        <div class="card" style="text-align: center; padding: 40px 20px; display: flex; flex-direction: column; align-items: center;">
            <div class="hero-power-container">
                <div class="hero-ring"></div>
                <div class="hero-number" id="hero-display">0</div>
            </div>
            <p id="h-hero-desc" style="font-size: 1.3rem; margin: 10px 0; font-weight: bold;">ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ù‚ÙˆØ© ÙˆØ§Ù„Ø¹Ø¸Ù…Ø©</p>
            <button class="btn-action" id="btn-hero-claim" onclick="claimHero()" style="background: linear-gradient(45deg, var(--main), #ff5e62); transform: scale(1.05);">Ø£Ù†Ø§ Ø¨Ø·Ù„Ø© Ø§Ù„ÙŠÙˆÙ… âœ¨</button>
            <button id="btn-hero-reset" onclick="resetHero()" style="background:none; border:none; color:gray; margin-top:25px; text-decoration: underline; cursor: pointer;">Ù„Ù‚Ø¯ Ø¶Ø¹ÙØª (ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯) ğŸ’”</button>
        </div>
    </section>
</div>

<div class="navbar">
    <div class="nav-btn active" onclick="nav('prayers', this)">ğŸ•‹</div>
    <div class="nav-btn" onclick="nav('goals', this)">ğŸ“</div>
    <div class="nav-btn" onclick="nav('stats', this)">ğŸ“Š</div>
    <div class="nav-btn" onclick="nav('challenges', this)" id="nav-chal">ğŸ†<div class="nav-dot" id="nav-dot"></div></div>
    <div class="nav-btn" onclick="nav('hero', this)">ğŸ‘‘</div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('salma_supreme_v8')) || { days:{}, goals:[], hero:0, lastH:"", totalR:0, ui:'comedy', badges:[], profilePic:"" };
    let today = new Date().toDateString();
    if(!db.days[today]) db.days[today] = { p:[], r:0 };

    // --- DATA & CONFIG ---
    // Added 'Salma' specific personalization in strings
    const modes = {
        comedy: {
            h: ["Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ø·ÙˆÙ„Ø§Øª", "Ù†Ø§ÙˆÙŠØ© Ø¹Ù„Ù‰ Ø¥ÙŠÙ‡ØŸ", "Ø­ØµØ§Ø¯ Ø§Ù„Ø¹Ø¸Ù…Ø©", "Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¨Ø±ÙˆØª", "Ø±Ø­Ù„Ø© Ø§Ù„ØµØ¹ÙˆØ¯"],
            cheat: ["Ø£Ù‡Ù„Ø§Ù‹ ÙŠØ§ Ù†ØµØ§Ø¨Ø©! ğŸ˜‚", "ÙŠØ§ Ø³Ù„Ù…Ù‰ Ø§Ù„ÙˆÙ‚Øª Ù„Ø³Ù‡ Ù…Ø¬Ø§Ø´ØŒ Ø¨Ù„Ø§Ø´ Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù‚Ø±Ø¹ Ø¯ÙŠ ÙˆØµÙ„ÙŠ Ø§Ù„Ø£ÙˆÙ„! ğŸ™„"],
            dua: "Ø¹Ø§Ø´ ÙŠØ§ ÙˆØ­Ø´.. Ø±ÙƒØ¹Ø§ØªÙƒ ÙÙŠ Ø§Ù„Ù…ÙŠØ²Ø§Ù† ÙŠØ§ Ø³Ù„Ù…Ù‰!",
            rank: ["Ù†ØµØ§Ø¨Ø© Ù„Ø³Ù‡", "Ø³Ù„Ù…Ù‰ Ø§Ù„Ù…ÙƒØ§ÙØ­Ø©", "ÙˆØ­Ø´ ØµÙ„Ø§Ø©", "Ø£Ø³Ø·ÙˆØ±Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…"],
            hero_btn: "Ø£Ù†Ø§ Ø¨Ø·Ù„Ø© Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ø© âœ¨", hero_reset: "Ø¶Ø¹ÙØª (ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯) ğŸ’”"
        },
        holy: {
            h: ["Ø²Ø§Ø¯ Ø§Ù„Ø·Ø§Ø¹Ø§Øª", "Ø¨Ø³ØªØ§Ù† Ø§Ù„Ù…Ù‚Ø§ØµØ¯", "Ø³Ø¬Ù„ Ø§Ù„Ø­Ø³Ù†Ø§Øª", "Ù…Ù‚Ø§Ù… Ø§Ù„Ø«Ø¨Ø§Øª", "Ù…Ø¹Ø±Ø§Ø¬ Ø§Ù„Ø±ÙˆØ­"],
            cheat: ["ØµØ¨Ø±Ø§Ù‹ ÙŠØ§ Ø³Ù„Ù…Ù‰ âœ¨", "Ù„Ù… ÙŠØ­Ù† ÙˆÙ‚Øª Ø§Ù„ÙØ±ÙŠØ¶Ø© Ø¨Ø¹Ø¯ØŒ Ø§Ù„ØµÙ„Ø§Ø© ÙƒØ§Ù†Øª Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¤Ù…Ù†ÙŠÙ† ÙƒØªØ§Ø¨Ø§Ù‹ Ù…ÙˆÙ‚ÙˆØªØ§Ù‹."],
            dua: "ØªÙ‚Ø¨Ù„ Ø§Ù„Ù„Ù‡ Ø·Ø§Ø¹ØªÙƒÙ ÙŠØ§ Ø³Ù„Ù…Ù‰ØŒ ÙˆØ²Ø§Ø¯ÙƒÙ Ù…Ù† ÙØ¶Ù„Ù‡ ÙˆÙ†ÙˆØ±Ù‡.",
            rank: ["Ø·Ø§Ù„Ø¨Ø© Ø¹Ù„Ù…", "Ø¹Ø§Ø¨Ø¯Ø©", "Ù‚Ø§Ù†ØªØ©", "Ù…Ù† Ø£Ù‡Ù„ Ø§Ù„ØµÙ„Ø§Ø©"],
            hero_btn: "Ø«Ø¨ØªÙ†ÙŠ Ø§Ù„Ù„Ù‡ Ø§Ù„ÙŠÙˆÙ… ğŸŒ¿", hero_reset: "Ø£Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡ (Ø¥Ø¹Ø§Ø¯Ø©) ğŸŒ™"
        },
        zen: {
            h: ["ÙˆÙ‚Øª Ø§Ù„Ø³ÙƒÙŠÙ†Ø©", "Ø£Ø­Ù„Ø§Ù…ÙŠ Ø§Ù„Ø¬Ù…ÙŠÙ„Ø©", "Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²", "Ø£Ù†Ø§ Ø£Ø³ØªØ·ÙŠØ¹", "Ø­Ø¯ÙŠÙ‚Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª"],
            cheat: ["Ø§Ù†ØªØ¸Ø±ÙŠ Ù‚Ù„ÙŠÙ„Ø§Ù‹ â˜ï¸", "Ø¬Ù…ÙŠÙ„ØªÙŠ Ø³Ù„Ù…Ù‰ØŒ Ø§Ù„ÙˆÙ‚Øª Ù„Ù… ÙŠØ­Ù† Ø¨Ø¹Ø¯.. Ø§Ù„Ù‚Ù„ÙŠÙ„ Ù…Ù† Ø§Ù„ØµØ¨Ø±."],
            dua: "ÙØ®ÙˆØ±Ø© Ø¨ÙƒÙ Ø¬Ø¯Ø§Ù‹ ÙŠØ§ Ø³Ù„Ù…Ù‰.. Ø±ÙˆØ­ÙƒÙ Ø£ØµØ¨Ø­Øª Ø£Ø¬Ù…Ù„ Ø§Ù„Ø¢Ù†.",
            rank: ["Ø¨Ø¯Ø§ÙŠØ© Ø±Ù‚ÙŠÙ‚Ø©", "Ø²Ù‡Ø±Ø© Ù…ØªÙØªØ­Ø©", "Ù†Ø¬Ù…Ø© Ø³Ø§Ø·Ø¹Ø©", "Ù…Ù„ÙƒØ© Ø§Ù„Ù‡Ø¯ÙˆØ¡"],
            hero_btn: "ÙŠÙˆÙ… Ø³Ø¹ÙŠØ¯ ÙˆÙ†Ø§Ø¬Ø­ ğŸŒ¸", hero_reset: "Ø³Ø£Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ ğŸ€"
        }
    };

    // --- NEW: Cheerful Variable Sentences ---
    const happyMessages = [
        "Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙƒÙ ÙŠØ§ Ø³Ù„Ù…Ù‰! Ù†ÙˆØ± Ø¹Ù„Ù‰ Ù†ÙˆØ± âœ¨",
        "Ø®Ø·ÙˆØ© Ù…Ù…ØªØ§Ø²Ø© Ù†Ø­Ùˆ Ø§Ù„Ø¬Ù†Ø© ÙŠØ§ Ø¬Ù…ÙŠÙ„Ø© ğŸŒ¸",
        "Ù‚Ù„Ø¨Ùƒ Ø¯Ù„ÙˆÙ‚ØªÙŠ Ø£Ù†Ù‚Ù‰ ÙˆØ£Ø¬Ù…Ù„! ğŸ’–",
        "Ø³Ù„Ù…Ù‰ ÙÙŠ Ø§Ù„Ù‚Ù…Ø©.. Ø§Ø³ØªÙ…Ø±ÙŠ ÙŠØ§ Ø¨Ø·Ù„Ø©! ğŸš€",
        "Ù…Ù„Ø§ÙŠÙƒØ© Ø§Ù„Ø³Ù…Ø§Ø¡ Ø¨ØªØ¯Ø¹ÙŠ Ù„Ùƒ Ø¯Ù„ÙˆÙ‚ØªÙŠ ğŸ•Šï¸",
        "Ø±Ø§Ø­Ø© Ù†ÙØ³ÙŠØ© Ù…Ù„Ù‡Ø§Ø´ ÙˆØµÙ.. ØªÙ‚Ø¨Ù„ Ø§Ù„Ù„Ù‡! ğŸŒ¿"
    ];

    // --- CHALLENGE SYSTEM (INTELLIGENT) ---
    const challenges = [
        {
            id: 'level1',
            title: "ÙØ±Ø§Ø´Ø© Ø§Ù„Ù†ÙˆØ± ğŸ¦‹",
            desc: "Ø£ØªÙ…ÙŠ Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„Ø®Ù…Ø³ Ø§Ù„ÙŠÙˆÙ… + Ø«Ø¨Ø§Øª 3 Ø£ÙŠØ§Ù…",
            icon: "ğŸ¦‹",
            req: { streak: 3, prayersToday: 5 },
            isLocked: (d) => false 
        },
        {
            id: 'level2',
            title: "Ø¬ÙˆÙ‡Ø±Ø© Ø§Ù„ÙØ¬Ø± ğŸ’",
            desc: "ØµÙ„Ø§Ø© Ø§Ù„ÙØ¬Ø± Ù„ÙŠÙˆÙ…ÙŠÙ† Ù…ØªØªØ§Ù„ÙŠÙŠÙ† + Ø«Ø¨Ø§Øª 7 Ø£ÙŠØ§Ù…",
            icon: "ğŸ’",
            req: { streak: 7, consecutiveFajr: 2 },
            isLocked: (d) => !d.badges.includes('level1')
        },
        {
            id: 'level3',
            title: "Ø¯Ø±Ø¹ Ø§Ù„Ø¹Ø¸Ù…Ø© ğŸ›¡ï¸",
            desc: "Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø«Ø¨Ø§Øª 15 ÙŠÙˆÙ…Ø§Ù‹ Ø¯ÙˆÙ† Ø§Ù†Ù‚Ø·Ø§Ø¹",
            icon: "ğŸ›¡ï¸",
            req: { streak: 15 },
            isLocked: (d) => !d.badges.includes('level2')
        },
        {
            id: 'level4',
            title: "Ø§Ù„Ù…Ù„ÙƒØ© Ø§Ù„Ù…ØªÙˆØ¬Ø© ğŸ‘‘",
            desc: "30 ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø«Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ. Ø£Ù†ØªÙ Ø§Ù„Ø¢Ù† ÙÙŠ Ø§Ù„Ù‚Ù…Ø©.",
            icon: "ğŸ‘‘",
            req: { streak: 30 },
            isLocked: (d) => !d.badges.includes('level3')
        }
    ];

    // --- MAIN FUNCTIONS ---
    function applyMode(m) {
        db.ui = m;
        document.body.className = 'mode-' + m;
        const c = modes[m];
        ['prayers','goals','stats','hero','challenges'].forEach((id, i) => {
            document.getElementById('h-'+id).innerText = c.h[i];
        });
        document.getElementById('btn-hero-claim').innerText = c.hero_btn;
        document.getElementById('btn-hero-reset').innerText = c.hero_reset;
        save(); renderStats(); renderChallenges();
    }

    function nav(id, el) {
        document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        if(id === 'stats') renderStats();
        if(id === 'challenges') renderChallenges();
    }

    function markPrayer(id, r, hr) {
        let now = new Date().getHours();
        if(db.days[today].p.includes(id)) return showModal("Ù…Ù‚Ø¨ÙˆÙ„Ø©", "Ù…Ø³Ø¬Ù„Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙŠØ§ Ø³Ù„Ù…Ù‰!");
        if(now < hr) return showModal(modes[db.ui].cheat[0], modes[db.ui].cheat[1]);
        
        db.days[today].p.push(id); db.days[today].r += r; db.totalR += r;
        save(); updateUI(); renderChallenges();
        
        // Random cheerful message logic
        let randomMsg = happyMessages[Math.floor(Math.random() * happyMessages.length)];
        
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#ff007f'] });
        showModal("ØªÙ‚Ø¨Ù„ Ø§Ù„Ù„Ù‡ ÙŠØ§ Ø³Ù„Ù…Ù‰", randomMsg);
    }

    function claimHero() {
        if(db.lastH === today) return alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…!");
        db.hero++; db.lastH = today; save(); updateUI(); renderChallenges();
        confetti({ particleCount: 200, scalar: 1.2, shapes: ['star'] });
    }

    function resetHero() {
        if(confirm("ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØµÙÙŠØ±ØŸ")) {
            db.hero = 0; db.lastH = ""; save(); updateUI(); renderChallenges();
        }
    }

    // --- RENDER CHALLENGES (COMPLEX LOGIC) ---
    function renderChallenges() {
        const list = document.getElementById('challenges-list');
        list.innerHTML = '';
        let hasNotification = false;

        challenges.forEach(c => {
            const locked = c.isLocked(db);
            const claimed = db.badges.includes(c.id);
            
            // Logic for Progress
            let progress = 0;
            let canClaim = false;

            if(!locked && !claimed) {
                let p1 = Math.min(db.hero, c.req.streak) / c.req.streak;
                let p2 = 1;
                if(c.req.prayersToday) p2 = db.days[today].p.length / c.req.prayersToday;
                let p3 = 1;
                if(c.req.consecutiveFajr) {
                     let y = new Date(); y.setDate(y.getDate()-1);
                     let f1 = db.days[today].p.includes('fajr');
                     let f2 = db.days[y.toDateString()] && db.days[y.toDateString()].p.includes('fajr');
                     let count = (f1?1:0) + (f2?1:0);
                     p3 = count / 2;
                }
                progress = (p1 + p2 + p3) / (Object.keys(c.req).length) * 100;
                if(db.hero >= c.req.streak) {
                    if(c.req.prayersToday && db.days[today].p.length < 5) progress = 90; 
                    if(c.req.consecutiveFajr && progress < 100) progress = 90;
                }
                if (progress >= 100) { canClaim = true; hasNotification = true; }
            }

            let btnHtml = '';
            if(claimed) btnHtml = <div style="text-align:center; color:#00e676; font-weight:bold; margin-top:10px;">âœ¨ ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„ÙŠÙ‡ âœ¨</div>;
            else if(canClaim) btnHtml = <button class="claim-btn" onclick="unlockBadge('${c.id}', '${c.title}', '${c.icon}')">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ÙˆØ³Ø§Ù… ğŸ</button>;
            else if(!locked) btnHtml = 
                <div class="progress-area">
                    <div class="progress-label"><span>Ø§Ù„ØªÙ‚Ø¯Ù…</span><span>${Math.floor(progress)}%</span></div>
                    <div class="progress-bar"><div class="progress-fill" style="width:${progress}%"></div></div>
                </div>;

            let cardClass = locked ? 'locked' : (claimed ? 'completed' : 'active-challenge');
            let iconDisplay = locked ? 'ğŸ”’' : c.icon;
            let titleDisplay = locked ? 'ØŸØŸØŸØŸØŸØŸ' : c.title;
            let descDisplay = locked ? 'Ø£ÙƒÙ…Ù„ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù„ÙØªØ­ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙˆÙ‰' : c.desc;

            list.innerHTML += 
            <div class="badge-card ${cardClass}">
                ${locked ? '<div class="lock-overlay"><div class="lock-icon">ğŸ”’</div><div style="font-size:0.8rem">Ù…Ø³ØªÙˆÙ‰ Ù…ØºÙ„Ù‚</div></div>' : ''}
                <div class="badge-header">
                    <div class="badge-icon">${iconDisplay}</div>
                    <div class="badge-info">
                        <h3>${titleDisplay}</h3>
                        <p>${descDisplay}</p>
                    </div>
                </div>
                ${btnHtml}
            </div>;
        });
        document.getElementById('nav-dot').style.display = hasNotification ? 'block' : 'none';
    }

    function unlockBadge(id, title, icon) {
        db.badges.push(id);
        save();
        renderChallenges();
        document.getElementById('r-icon').innerText = icon;
        document.getElementById('r-title').innerText = title;
        document.getElementById('reward-modal').style.display = 'flex';
        var duration = 3 * 1000;
        var end = Date.now() + duration;
        (function frame() {
            confetti({ particleCount: 7, angle: 60, spread: 55, origin: { x: 0 } });
            confetti({ particleCount: 7, angle: 120, spread: 55, origin: { x: 1 } });
            if (Date.now() < end) requestAnimationFrame(frame);
        }());
    }

    function closeReward() {
        document.getElementById('reward-modal').style.display = 'none';
    }

    // --- OTHER UI LOGIC ---
    function renderStats() {
        document.getElementById('st-total').innerText = db.totalR;
        document.getElementById('st-badges').innerText = db.badges.length;
        let rankIdx = Math.min(Math.floor(db.badges.length), 3); 
        document.getElementById('st-rank').innerText = modes[db.ui].rank[rankIdx];

        // Chart & Analytics Logic
        let hChart = document.getElementById('history-chart'); hChart.innerHTML = '';
        let hList = document.getElementById('history-list'); hList.innerHTML = '';
        let totalWeekP = 0;
        let daysCounted = 0;
        let maxP = 0;
        let bestDay = "Ù„Ù… ÙŠØ­Ø¯Ø¯";

        // Generate last 7 days chart
        for(let i=6; i>=0; i--) {
            let d = new Date(); d.setDate(d.getDate() - i);
            let k = d.toDateString();
            let dayName = d.toLocaleDateString('ar-EG', {weekday: 'short'});
            let val = db.days[k] ? db.days[k].p.length : 0; // Count prayers not rakaat for chart
            
            // Stats Calculations
            totalWeekP += val;
            daysCounted++;
            if(val > maxP) { maxP = val; bestDay = dayName; }

            // Chart bar
            let h = (val/5)*100; // 5 prayers max
            hChart.innerHTML += <div class="bar-col"><div style="font-size:0.6rem; margin-bottom:5px;">${dayName}</div><div class="bar ${val>=5?'high':''}" style="height:${h||5}%"></div></div>;
        }
        
        // Detailed List (All recorded days)
        Object.keys(db.days).reverse().forEach(k => {
             let dObj = db.days[k];
             if(dObj.p.length > 0) {
                 hList.innerHTML += <div class="history-item"><span>${new Date(k).toLocaleDateString('ar-EG')}</span> <span>${dObj.p.length} ØµÙ„ÙˆØ§Øª âœ…</span></div>;
             }
        });

        // Fill Analytics
        document.getElementById('ana-avg').innerText = Math.round((totalWeekP / (7*5))*100) + "%";
        document.getElementById('ana-best').innerText = bestDay;
        document.getElementById('ana-today').innerText = db.days[today].p.length;
    }

    function addGoal() {
        let v = document.getElementById('goal-in').value; if(!v) return;
        db.goals.push({ t:v, d:false }); document.getElementById('goal-in').value = '';
        save(); renderGoals();
    }
    function renderGoals() {
        let l = document.getElementById('goal-list'); l.innerHTML = '';
        db.goals.forEach((g, i) => {
            l.innerHTML += <div class="item-row ${g.d?'done':''}" onclick="db.goals[${i}].d=!db.goals[${i}].d; save(); renderGoals();">
                <span>${g.t}</span> ${g.d?'âœ…':'â­•'}</div>;
        });
    }

    function showModal(t, b) {
        document.getElementById('m-title').innerText = t;
        document.getElementById('m-body').innerText = b;
        document.getElementById('modal').style.display = 'flex';
    }
    function save() { localStorage.setItem('salma_supreme_v8', JSON.stringify(db)); }
    
    // --- NEW: Profile Image Logic ---
    function uploadImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                db.profilePic = e.target.result;
                save();
                document.getElementById('p-img').src = e.target.result;
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    // --- NEW: Reminder/Timer Logic ---
    function updateTimers() {
        let now = new Date();
        let hour = now.getHours();
        
        // Define Hours (approx)
        let prayers = { 'fajr':4, 'dhuhr':12, 'asr':15, 'maghrib':17, 'isha':19 };
        let nextP = "";
        let minDiff = 24;
        
        // Check for late prayers
        for(let [p, h] of Object.entries(prayers)) {
            let el = document.getElementById('late-'+p);
            if(hour >= h + 1 && !db.days[today].p.includes(p)) {
                el.style.display = 'inline-block';
            } else {
                el.style.display = 'none';
            }
            
            // Calculate next prayer
            if (hour < h) {
                let diff = h - hour;
                if(diff < minDiff) { minDiff = diff; nextP = p; }
            }
        }

        let timerEl = document.getElementById('next-prayer-timer');
        if(nextP) {
            // Simple visual countdown simulation
            let minLeft = 60 - now.getMinutes();
            let hrLeft = minDiff - 1;
            timerEl.innerText = Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: Ø®Ù„Ø§Ù„ ${hrLeft} Ø³Ø§Ø¹Ø© Ùˆ ${minLeft} Ø¯Ù‚ÙŠÙ‚Ø©;
            if(hrLeft === 0 && minLeft <= 10) {
                timerEl.style.background = 'var(--danger)'; 
                timerEl.innerText += " (Ø§Ù‚ØªØ±Ø¨ Ø§Ù„ÙˆÙ‚Øª!)";
            } else {
                timerEl.style.background = 'rgba(0,0,0,0.3)';
            }
        } else {
             timerEl.innerText = "Ø§Ù†ØªÙ‡Øª ØµÙ„ÙˆØ§Øª Ø§Ù„ÙŠÙˆÙ….. Ù‚ÙŠØ§Ù… Ø§Ù„Ù„ÙŠÙ„ØŸ âœ¨";
        }
    }

    function updateUI() {
        document.getElementById('hero-display').innerText = db.hero;
        document.querySelectorAll('.item-row').forEach(el => {
            if(db.days[today] && db.days[today].p.includes(el.id)) el.classList.add('done');
        });
        if(db.profilePic) document.getElementById('p-img').src = db.profilePic;
        renderStats();
        updateTimers();
    }

    // Stars & Init
    const sContainer = document.getElementById('stars');
    for(let i=0; i<50; i++) {
        let s = document.createElement('div'); s.className = 'star';
        let size = Math.random()*3;
        s.style.width = size+'px'; s.style.height = size+'px';
        s.style.top = Math.random()*100+'%'; s.style.left = Math.random()*100+'%';
        s.style.setProperty('--d', (Math.random()*3+2)+'s');
        sContainer.appendChild(s);
    }
    
    // Timer Loop
    setInterval(updateTimers, 60000); 

    setTimeout(() => { document.getElementById('splash').style.opacity='0'; setTimeout(()=>{document.getElementById('splash').style.display='none'},500); }, 2500);
    applyMode(db.ui); updateUI();
</script>
</body>
</html>
